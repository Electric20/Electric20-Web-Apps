
<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN" "http://www.w3.org/TR/html4/loose.dtd"> 
<html> 
 <head> 
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8"> 
    <title>Energy Data</title> 
    
    <!--[if lte IE 8]><script language="javascript" type="text/javascript" src="../excanvas.min.js"></script><![endif]--> 
    <script language="javascript" type="text/javascript" src="../pem/js/jquery-1.5.2.min.js"></script> 
    <script language="javascript" type="text/javascript" src="../flot/jquery.flot.js"></script> 
 </head> 
    <body> 
    <div id="placeholder" style="width:100%;height:100%;"></div> 

	<div id="selectBox"> </div>
 
    
 	
    <p id="choices">Show:</p> 
 
<script type="text/javascript"> 

var datasets;
var choiceContainer;
var selectDiv;
var dropBoxSelector;
var hubId;
$(function () {
    selectDiv = document.getElementById("selectBox");
	dropBoxForm = document.createElement("form");
	dropBoxSelector = document.createElement("select");
	dropBoxSelector.setAttribute('onChange',"alterHubId()");
	
	
	$.getJSON('getDistinctHubs.php', function(returnData)
	{
		for(var i = 0 ; i < returnData.length; i++)
		{
			 dropBoxSelector[dropBoxSelector.length] = new Option(returnData[i], returnData[i]);
			 hubId = returnData[i];
		}
	
	dropBoxForm.appendChild(dropBoxSelector);
	selectDiv.appendChild(dropBoxForm);
	
	var h1 = ($(window).height()*1);
	$("#placeholder").css('height',h1);
	choiceContainer = $("#choices");
	
	$.getJSON('multiSensor.php?hubId=' + hubId, function(data)
	{
		datasets = data.dataset;
		$.each(datasets, function(key, val) {
	       
	 		choiceContainer.append('<br/><input type="checkbox" name="' + key +
	                               '" checked="checked" id="id' + key + '">' +
	                               '<label for="id' + key + '">'
	                                + val.label + '</label>');
			
	    });
		choiceContainer.find("input").click(plotAccordingToChoices);
		plotAccordingToChoices();
		setInterval(fetchData, 3000);
		
	});
	});
});

function alterHubId()
{
	hubId = dropBoxSelector[dropBoxSelector.selectedIndex].value;
	document.getElementById('choices').innerHTML = "";
   
	$.getJSON('multiSensor.php?hubId=' + hubId, function(data)
	{
		
		datasets = data.dataset;
		$.each(datasets, function(key, val) {
	       
	 		choiceContainer.append('<br/><input type="checkbox" name="' + key +
	                               '" checked="checked" id="id' + key + '">' +
	                               '<label for="id' + key + '">'
	                                + val.label + '</label>');
			
	    });
		 

		
		choiceContainer.find("input").click(plotAccordingToChoices);
		
		
		
	});
}

function fetchData()
{
	$.ajax({
        url: "multiSensor.php?hubId="  + hubId,
        method: 'GET',
        dataType: 'json',
        success: plotAjax
    });


}

function plotAjax(series)
{
	datasets = series.dataset;
	plotAccordingToChoices();
}

function plotAccordingToChoices() {
    var data = [];

    choiceContainer.find("input:checked").each(function () {
        var key = $(this).attr("name");
        if (key && datasets[key])
            data.push(datasets[key]);
    });

    if (data.length > 0)
        $.plot($("#placeholder"), data, 
		{
		        series: 
				{
					lines: 
					{
						show: true
					},
					points: 
					{
						show: true
					}
		        },
		        legend:
				{
					noColumns: 2,
					position: "nw"
				},
		        grid: 
				{
					hoverable: true,
				},
				xaxis: 
				{ 
					tickDecimals: 0,
					mode: "time" 
				},
		        selection: 
				{ 
					mode: "x" 
				}
		});
}



</script> 
 
 </body> 
</html>